<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>分组获取最大</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="q5a8" id="分组获取最大">分组获取最大</h1><div class="md-section-divider"></div><h2 data-anchor-id="whz8" id="测试表">测试表</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="yulm"><ol class="linenums"><li class="L0"><code><span class="pln">CREATE TABLE </span><span class="str">`tb_group_max`</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L1"><code><span class="pln">  </span><span class="str">`Id`</span><span class="pln"> INT</span><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span><span class="pln"> NOT NULL AUTO_INCREMENT COMMENT </span><span class="str">'ID'</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">  </span><span class="str">`name`</span><span class="pln"> VARCHAR</span><span class="pun">(</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> NOT NULL COMMENT </span><span class="str">'名称'</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">  </span><span class="str">`sub_id`</span><span class="pln"> INT</span><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span><span class="pln"> NOT NULL COMMENT </span><span class="str">'subid'</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">  PRIMARY KEY </span><span class="pun">(</span><span class="str">`Id`</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pun">)</span><span class="pln"> ENGINE</span><span class="pun">=</span><span class="pln">INNODB DEFAULT CHARSET</span><span class="pun">=</span><span class="pln">utf8 COMMENT</span><span class="pun">=</span><span class="str">'测试表'</span><span class="pun">;</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="012s" id="测试数据">测试数据</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="j49z"><ol class="linenums"><li class="L0"><code><span class="pln">INSERT INTO </span><span class="str">`tb_group_max`</span><span class="pun">(</span><span class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`sub_id`</span><span class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'name1'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="str">'name2'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="str">'name3'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="str">'name4'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="str">'name5'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="str">'name6'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="9dbr" id="先排序在分组数据大时效率很低">先排序在分组(数据大时,效率很低)</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zqlg"><ol class="linenums"><li class="L0"><code><span class="pln">SELECT a</span><span class="pun">.</span><span class="pln">id FROM </span><span class="pun">(</span></code></li><li class="L1"><code><span class="pln">SELECT t</span><span class="pun">.</span><span class="str">`id`</span><span class="pun">,</span><span class="pln"> t</span><span class="pun">.</span><span class="str">`sub_id`</span><span class="pln"> FROM tb_group_max t ORDER BY t</span><span class="pun">.</span><span class="str">`Id`</span><span class="pln"> DESC </span><span class="pun">)</span><span class="pln"> a</span></code></li><li class="L2"><code><span class="pln">GROUP BY a</span><span class="pun">.</span><span class="str">`sub_id`</span><span class="pun">;</span><span class="pln"> </span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="pegu" id="分组取字段最大值适合数字类型">分组取字段最大值（适合数字类型）</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a1i0"><ol class="linenums"><li class="L0"><code><span class="pln">SELECT MAX</span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="str">`id`</span><span class="pun">)</span><span class="pln"> FROM tb_group_max t GROUP BY t</span><span class="pun">.</span><span class="str">`sub_id`</span><span class="pun">;</span><span class="pln"> </span><span class="pun">--</span><span class="pln"> </span><span class="pun">可以先获取主键,在查询数据,或者直接</span><span class="pln">join</span><span class="pun">查询</span></code></li></ol></pre></div>
</body>
</html>